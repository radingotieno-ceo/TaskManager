<!-- TaskFlow Manager Dashboard -->
<div class="dashboard-container">
  <!-- Left Sidebar Navigation -->
  <nav class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <span class="logo-text" *ngIf="!sidebarCollapsed">TaskFlow</span>
      </div>
    </div>
    
    <div class="sidebar-nav">
      <a class="nav-item" [class.active]="activeTab === 'dashboard'" (click)="setActiveTab('dashboard')">
        <mat-icon>dashboard</mat-icon>
        <span *ngIf="!sidebarCollapsed">Dashboard</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'projects'" (click)="setActiveTab('projects')">
        <mat-icon>folder</mat-icon>
        <span *ngIf="!sidebarCollapsed">Projects</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'tasks'" (click)="setActiveTab('tasks')">
        <mat-icon>task</mat-icon>
        <span *ngIf="!sidebarCollapsed">Tasks</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'reports'" (click)="setActiveTab('reports')">
        <mat-icon>bar_chart</mat-icon>
        <span *ngIf="!sidebarCollapsed">Reports</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')">
        <mat-icon>settings</mat-icon>
        <span *ngIf="!sidebarCollapsed">Settings</span>
      </a>
    </div>
    
    <div class="sidebar-footer">
      <button class="collapse-btn" (click)="toggleSidebar()">
        <mat-icon>{{ sidebarCollapsed ? 'chevron_right' : 'chevron_left' }}</mat-icon>
      </button>
    </div>
  </nav>

  <!-- Main Content Area -->
  <main class="main-content" [class.sidebar-collapsed]="sidebarCollapsed">
    <!-- Top Header -->
    <header class="header">
      <div class="search-container">
        <mat-icon class="search-icon">search</mat-icon>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search projects, tasks, or team members..."
          [(ngModel)]="searchQuery"
          (input)="onSearch()"
        >
      </div>
      
      <div class="header-actions">
        <button class="notification-btn" (click)="showNotifications()">
          <mat-icon>notifications</mat-icon>
          <span class="notification-dot" *ngIf="hasNotifications"></span>
        </button>
        
        <div class="user-profile">
          <div class="avatar">
            <img *ngIf="currentUser?.profilePhotoUrl" [src]="getProfilePhotoUrl(currentUser?.profilePhotoUrl)" alt="Profile Photo" class="profile-image">
            <mat-icon *ngIf="!currentUser?.profilePhotoUrl">person</mat-icon>
          </div>
          <div class="user-info" *ngIf="currentUser">
            <div class="user-name">{{ currentUser.name }}</div>
            <div class="user-role-tag manager">{{ currentUser.role }}</div>
          </div>
        </div>
      </div>
    </header>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="action-btn new-project-btn" (click)="newProject()">
        <mat-icon>add</mat-icon>
        <span>+ New Project</span>
      </button>
      
      <button class="action-btn create-assign-task-btn" (click)="createAndAssignTask()">
        <mat-icon>assignment_ind</mat-icon>
        <span>Create & Assign Task</span>
      </button>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <!-- Loading State -->
      <div class="loading-container" *ngIf="loading">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading dashboard...</p>
      </div>

      <!-- Dashboard Content -->
      <div class="content-area" *ngIf="!loading">
        
        <!-- Dashboard Tab -->
        <div class="dashboard-tab" *ngIf="activeTab === 'dashboard'">
          <!-- Summary Cards -->
          <div class="summary-cards">
            <div class="summary-card total-projects">
              <div class="card-content">
                <div class="card-icon">
                  <mat-icon>folder</mat-icon>
                </div>
                <div class="card-info">
                  <h3 class="card-title">Total Projects</h3>
                  <div class="card-value">{{ summaryCards.totalProjects || 0 }}</div>
                  <div class="card-trend positive">
                    <mat-icon>trending_up</mat-icon>
                    <span>Active projects</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="summary-card active-tasks">
              <div class="card-content">
                <div class="card-icon">
                  <mat-icon>task</mat-icon>
                </div>
                <div class="card-info">
                  <h3 class="card-title">Active Tasks</h3>
                  <div class="card-value">{{ summaryCards.activeTasks || 0 }}</div>
                  <div class="card-trend">
                    <mat-icon>schedule</mat-icon>
                    <span>Currently in progress</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="summary-card completed-tasks">
              <div class="card-content">
                <div class="card-icon">
                  <mat-icon>check_circle</mat-icon>
                </div>
                <div class="card-info">
                  <h3 class="card-title">Completed Tasks</h3>
                  <div class="card-value">{{ summaryCards.completedTasks || 0 }}</div>
                  <div class="card-trend positive">
                    <mat-icon>trending_up</mat-icon>
                    <span>Successfully finished</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="summary-card team-members">
              <div class="card-content">
                <div class="card-icon">
                  <mat-icon>group</mat-icon>
                </div>
                <div class="card-info">
                  <h3 class="card-title">Overdue Tasks</h3>
                  <div class="card-value">{{ summaryCards.overdueTasks || 0 }}</div>
                  <div class="card-trend">
                    <span>Require attention</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Dashboard Sections -->
          <div class="dashboard-sections">
            <!-- Recent Projects Section -->
            <div class="section-card">
              <div class="section-header">
                <h2 class="section-title">Recent Projects</h2>
                <p class="section-subtitle">Your most active projects and their progress.</p>
              </div>
              
              <div class="project-list">
                <div class="project-item" *ngFor="let project of recentProjects">
                  <div class="project-info">
                    <h3 class="project-name">{{ project.name }}</h3>
                    <p class="project-description">{{ project.description }}</p>
                    <div class="project-meta">
                      <div class="project-progress">
                        <div class="progress-bar">
                          <div class="progress-fill" [style.width.%]="project.progress || 0"></div>
                        </div>
                        <span class="progress-text">{{ project.progress || 0 }}%</span>
                      </div>
                      <div class="project-status">
                        <span class="status-badge" [class]="(project.status || 'TODO').toLowerCase()">{{ project.status || 'TODO' }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Empty state -->
                <div class="empty-state" *ngIf="!recentProjects || recentProjects.length === 0">
                  <mat-icon class="empty-icon">folder</mat-icon>
                  <p class="empty-text">No projects yet</p>
                  <p class="empty-subtext">Create your first project to get started</p>
                </div>
              </div>
            </div>

            <!-- Recent Tasks Section -->
            <div class="section-card">
              <div class="section-header">
                <h2 class="section-title">Recent Tasks</h2>
                <p class="section-subtitle">Latest tasks across all projects.</p>
              </div>
              
              <div class="task-list">
                <div class="task-item" *ngFor="let task of recentTasks">
                  <div class="task-info">
                    <h3 class="task-name">{{ task.title }}</h3>
                    <p class="task-description">{{ task.description }}</p>
                    <div class="task-meta">
                      <span class="task-project">{{ task.project?.name || 'General' }}</span>
                      <span class="task-assignee" *ngIf="task.assignedUser">{{ task.assignedUser.name }}</span>
                    </div>
                    <div class="task-status">
                      <span class="status-badge" [class]="(task.status || 'TODO').toLowerCase()">{{ task.status || 'TODO' }}</span>
                      <span class="priority-badge" [class]="(task.priority || 'MEDIUM').toLowerCase()">{{ task.priority || 'MEDIUM' }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Empty state -->
                <div class="empty-state" *ngIf="!recentTasks || recentTasks.length === 0">
                  <mat-icon class="empty-icon">task_alt</mat-icon>
                  <p class="empty-text">No tasks yet</p>
                  <p class="empty-subtext">Create tasks to manage your projects</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Projects Tab -->
        <div class="projects-tab" *ngIf="activeTab === 'projects'">
          <div class="tab-header">
            <h2 class="tab-title">All Projects</h2>
            <p class="tab-subtitle">Manage and track all projects</p>
          </div>
          
          <div class="projects-grid">
            <div class="project-card" *ngFor="let project of recentProjects">
              <div class="project-header">
                <h3 class="project-title">{{ project.name }}</h3>
                <span class="status-badge" [class]="(project.status || 'TODO').toLowerCase()">{{ project.status || 'TODO' }}</span>
              </div>
              <div class="project-description">
                {{ project.description }}
              </div>
              <div class="project-progress">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="project.progress || 0"></div>
                </div>
                <span class="progress-text">{{ project.progress || 0 }}%</span>
              </div>
              <div class="project-actions">
                <button class="action-btn" (click)="viewProjectDetails(project)">
                  <mat-icon>visibility</mat-icon>
                  View Details
                </button>
              </div>
            </div>
            
            <!-- Empty state -->
            <div class="empty-state" *ngIf="!recentProjects || recentProjects.length === 0">
              <mat-icon class="empty-icon">folder</mat-icon>
              <p class="empty-text">No projects yet</p>
              <p class="empty-subtext">Create your first project to get started</p>
            </div>
          </div>
        </div>

        <!-- Tasks Tab -->
        <div class="tasks-tab" *ngIf="activeTab === 'tasks'">
          <div class="tab-header">
            <h2 class="tab-title">All Tasks</h2>
            <p class="tab-subtitle">Manage and track all tasks</p>
          </div>
          
          <div class="tasks-grid">
            <div class="task-card" *ngFor="let task of recentTasks">
              <div class="task-header">
                <h3 class="task-title">{{ task.title }}</h3>
                <div class="task-badges">
                  <span class="priority-badge" [class]="(task.priority || 'MEDIUM').toLowerCase()">{{ task.priority || 'MEDIUM' }}</span>
                  <span class="status-badge" [class]="(task.status || 'TODO').toLowerCase()">{{ task.status || 'TODO' }}</span>
                </div>
              </div>
              <div class="task-description">
                {{ task.description }}
              </div>
              <div class="task-meta">
                <div class="meta-item">
                  <mat-icon>folder</mat-icon>
                  <span>{{ task.project?.name || 'General' }}</span>
                </div>
                <div class="meta-item" *ngIf="task.assignedUser">
                  <mat-icon>person</mat-icon>
                  <span>{{ task.assignedUser.name }}</span>
                </div>
                <div class="meta-item">
                  <mat-icon>calendar_today</mat-icon>
                  <span>Due: {{ task.dueDate | date:'yyyy-MM-dd' || 'No due date' }}</span>
                </div>
              </div>
              <div class="task-actions">
                <button class="action-btn" (click)="viewTaskDetails(task)">
                  <mat-icon>visibility</mat-icon>
                  View Details
                </button>
              </div>
            </div>
            
            <!-- Empty state -->
            <div class="empty-state" *ngIf="!recentTasks || recentTasks.length === 0">
              <mat-icon class="empty-icon">task_alt</mat-icon>
              <p class="empty-text">No tasks yet</p>
              <p class="empty-subtext">Create tasks to manage your projects</p>
            </div>
          </div>
        </div>

        <!-- Reports Tab -->
        <div class="reports-tab" *ngIf="activeTab === 'reports'">
          <div class="tab-header">
            <h2 class="tab-title">Reports & Analytics</h2>
            <p class="tab-subtitle">View project and task analytics</p>
          </div>
          
          <div class="reports-content">
            <div class="report-section">
              <h3>Project Statistics</h3>
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-value">{{ summaryCards.totalProjects }}</div>
                  <div class="stat-label">Total Projects</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">{{ summaryCards.activeTasks }}</div>
                  <div class="stat-label">Active Tasks</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">{{ summaryCards.completedTasks }}</div>
                  <div class="stat-label">Completed Tasks</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">{{ summaryCards.overdueTasks }}</div>
                  <div class="stat-label">Overdue Tasks</div>
                </div>
              </div>
            </div>
            
            <div class="report-section">
              <h3>Task Status Distribution</h3>
              <p>Reports functionality coming soon...</p>
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div class="settings-tab" *ngIf="activeTab === 'settings'">
          <div class="tab-header">
            <h2 class="tab-title">Settings</h2>
            <p class="tab-subtitle">Manage your account settings and profile</p>
          </div>
          
          <div class="settings-content">
            <!-- Profile Information Section -->
            <div class="setting-section">
              <h3>Profile Information</h3>
              <div class="profile-info" *ngIf="currentUser">
                <div class="profile-photo-section">
                  <div class="profile-photo">
                    <img *ngIf="currentUser?.profilePhotoUrl" [src]="getProfilePhotoUrl(currentUser?.profilePhotoUrl)" alt="Profile Photo" class="profile-image">
                    <div *ngIf="!currentUser?.profilePhotoUrl" class="profile-placeholder">
                      <mat-icon>person</mat-icon>
                    </div>
                  </div>
                  <div class="photo-actions">
                    <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none;">
                    <button class="action-btn" (click)="fileInput.click()">
                      <mat-icon>photo_camera</mat-icon>
                      Upload Photo
                    </button>
                    <button *ngIf="currentUser?.profilePhotoUrl" class="action-btn secondary" (click)="removeProfilePhoto()">
                      <mat-icon>delete</mat-icon>
                      Remove Photo
                    </button>
                  </div>
                </div>
                
                <div class="profile-details">
                  <div class="info-item">
                    <label>Name:</label>
                    <span>{{ currentUser.name }}</span>
                    <button class="edit-btn" (click)="editProfile()">
                      <mat-icon>edit</mat-icon>
                    </button>
                  </div>
                  <div class="info-item">
                    <label>Email:</label>
                    <span>{{ currentUser.email }}</span>
                  </div>
                  <div class="info-item">
                    <label>Role:</label>
                    <span class="role-badge">{{ currentUser.role }}</span>
                  </div>
                  <div class="info-item" *ngIf="currentUser.createdAt">
                    <label>Member Since:</label>
                    <span>{{ currentUser.createdAt | date:'mediumDate' }}</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Security Section -->
            <div class="setting-section">
              <h3>Security</h3>
              <div class="security-actions">
                <button class="action-btn" (click)="showChangePasswordModal()">
                  <mat-icon>lock</mat-icon>
                  Change Password
                </button>
                <button class="action-btn secondary" (click)="showTwoFactorAuth()">
                  <mat-icon>security</mat-icon>
                  Two-Factor Authentication
                </button>
              </div>
            </div>
            
            <!-- Preferences Section -->
            <div class="setting-section">
              <h3>Preferences</h3>
              <div class="preferences">
                <div class="preference-item">
                  <label>Email Notifications</label>
                  <mat-slide-toggle [(ngModel)]="preferences.emailNotifications">
                    Receive email notifications
                  </mat-slide-toggle>
                </div>
                <div class="preference-item">
                  <label>Task Reminders</label>
                  <mat-slide-toggle [(ngModel)]="preferences.taskReminders">
                    Get task reminders
                  </mat-slide-toggle>
                </div>
                <div class="preference-item">
                  <label>Theme</label>
                  <mat-form-field>
                    <mat-select [(ngModel)]="preferences.theme">
                      <mat-option value="light">Light</mat-option>
                      <mat-option value="dark">Dark</mat-option>
                      <mat-option value="auto">Auto</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Edit Modal -->
        <div class="modal-overlay" *ngIf="showProfileEditModal" (click)="closeProfileEditModal()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3>Edit Profile</h3>
              <button class="close-btn" (click)="closeProfileEditModal()">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <div class="modal-body">
              <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
                <div class="form-group">
                  <label for="profileName">Name</label>
                  <input type="text" id="profileName" formControlName="name" placeholder="Enter your name">
                </div>
                <div class="form-group">
                  <label for="profileEmail">Email</label>
                  <input type="email" id="profileEmail" formControlName="email" placeholder="Enter your email">
                </div>
                <div class="form-actions">
                  <button type="button" class="btn-secondary" (click)="closeProfileEditModal()">Cancel</button>
                  <button type="submit" class="btn-primary" [disabled]="profileForm.invalid || updatingProfile">
                    {{ updatingProfile ? 'Updating...' : 'Update Profile' }}
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Change Password Modal -->
        <div class="modal-overlay" *ngIf="showPasswordModal" (click)="closePasswordModal()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h3>Change Password</h3>
              <button class="close-btn" (click)="closePasswordModal()">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <div class="modal-body">
              <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
                <div class="form-group">
                  <label for="currentPassword">Current Password</label>
                  <input type="password" id="currentPassword" formControlName="currentPassword" placeholder="Enter current password">
                </div>
                <div class="form-group">
                  <label for="newPassword">New Password</label>
                  <input type="password" id="newPassword" formControlName="newPassword" placeholder="Enter new password">
                </div>
                <div class="form-group">
                  <label for="confirmPassword">Confirm New Password</label>
                  <input type="password" id="confirmPassword" formControlName="confirmPassword" placeholder="Confirm new password">
                </div>
                <div class="form-actions">
                  <button type="button" class="btn-secondary" (click)="closePasswordModal()">Cancel</button>
                  <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid || changingPassword">
                    {{ changingPassword ? 'Changing...' : 'Change Password' }}
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Task Assignment Modal -->
<div class="modal-overlay" *ngIf="showTaskAssignmentModal" (click)="closeTaskAssignmentModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Assign Task</h2>
      <button class="close-btn" (click)="closeTaskAssignmentModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="task-selection" *ngIf="!selectedTask">
        <h3>Select Task to Assign</h3>
        <div class="task-list">
          <div class="task-item" *ngFor="let task of unassignedTasks" (click)="openTaskAssignmentModal(task)">
            <div class="task-info">
              <h4>{{ task.title }}</h4>
              <p>{{ task.description }}</p>
              <div class="task-meta">
                                 <span class="priority-badge" [class]="(task.priority || 'MEDIUM').toLowerCase()">{{ task.priority || 'MEDIUM' }}</span>
                <span class="project-name">{{ task.project?.name }}</span>
                <span class="due-date">Due: {{ task.dueDate | date:'yyyy-MM-dd' }}</span>
              </div>
            </div>
          </div>
          
          <!-- Empty state -->
          <div class="empty-state" *ngIf="unassignedTasks.length === 0">
            <mat-icon class="empty-icon">task_alt</mat-icon>
            <p class="empty-text">No unassigned tasks</p>
            <p class="empty-subtext">All tasks are currently assigned</p>
          </div>
        </div>
      </div>
      
      <div class="user-selection" *ngIf="selectedTask && !selectedUser">
        <h3>Select User to Assign Task</h3>
        <p><strong>Task:</strong> {{ selectedTask.title }}</p>
        <div class="user-list">
          <div class="user-item" *ngFor="let user of availableUsers" (click)="selectUserForAssignment(user)">
            <div class="user-info">
              <div class="user-avatar">
                <mat-icon>person</mat-icon>
              </div>
              <div class="user-details">
                <h4>{{ user.name }}</h4>
                <p>{{ user.email }}</p>
                <span class="user-role">{{ user.role }}</span>
              </div>
            </div>
          </div>
          
          <!-- Empty state -->
          <div class="empty-state" *ngIf="availableUsers.length === 0">
            <mat-icon class="empty-icon">group</mat-icon>
            <p class="empty-text">No users available</p>
            <p class="empty-subtext">No users are available for task assignment</p>
          </div>
        </div>
      </div>
      
      <div class="confirmation" *ngIf="selectedTask && selectedUser">
        <h3>Confirm Assignment</h3>
        <div class="assignment-details">
          <p><strong>Task:</strong> {{ selectedTask.title }}</p>
          <p><strong>Assign to:</strong> {{ selectedUser.name }}</p>
          <p><strong>User Role:</strong> {{ selectedUser.role }}</p>
        </div>
        <div class="modal-actions">
          <button class="btn-secondary" (click)="closeTaskAssignmentModal()">Cancel</button>
          <button class="btn-primary" (click)="assignTaskToUser()">Confirm Assignment</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create Project Modal -->
<div class="modal-overlay" *ngIf="showCreateProjectModal" (click)="closeCreateProjectModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Project</h2>
      <button class="close-btn" (click)="closeCreateProjectModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <form class="create-project-form" (ngSubmit)="createProject()">
        <div class="form-group">
          <label for="projectName">Project Name *</label>
                     <input 
             type="text" 
             id="projectName" 
             [(ngModel)]="newProjectForm.name" 
             name="name"
             placeholder="Enter project name"
             required
           >
        </div>
        
        <div class="form-group">
          <label for="projectDescription">Description</label>
                     <textarea 
             id="projectDescription" 
             [(ngModel)]="newProjectForm.description" 
             name="description"
             placeholder="Enter project description"
             rows="3"
           ></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="projectPriority">Priority</label>
                         <select 
               id="projectPriority" 
               [(ngModel)]="newProjectForm.priority" 
               name="priority"
             >
              <option value="LOW">Low</option>
              <option value="MEDIUM">Medium</option>
              <option value="HIGH">High</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="projectDueDate">Due Date *</label>
                         <input 
               type="date" 
               id="projectDueDate" 
               [(ngModel)]="newProjectForm.dueDate" 
               name="dueDate"
               required
             >
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeCreateProjectModal()">Cancel</button>
          <button type="submit" class="btn-primary">Create Project</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Create Task Modal -->
<div class="modal-overlay" *ngIf="showCreateTaskModal" (click)="closeCreateTaskModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create New Task</h2>
      <button class="close-btn" (click)="closeCreateTaskModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <form class="create-task-form" (ngSubmit)="createTask()">
        <div class="form-group">
          <label for="taskTitle">Task Title *</label>
          <input 
            type="text" 
            id="taskTitle" 
            [(ngModel)]="newTask.title" 
            name="title"
            placeholder="Enter task title"
            required
          >
        </div>
        
        <div class="form-group">
          <label for="taskDescription">Description</label>
          <textarea 
            id="taskDescription" 
            [(ngModel)]="newTask.description" 
            name="description"
            placeholder="Enter task description"
            rows="3"
          ></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="taskPriority">Priority</label>
            <select 
              id="taskPriority" 
              [(ngModel)]="newTask.priority" 
              name="priority"
            >
              <option value="LOW">Low</option>
              <option value="MEDIUM">Medium</option>
              <option value="HIGH">High</option>
              <option value="CRITICAL">Critical</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="taskDueDate">Due Date *</label>
            <input 
              type="date" 
              id="taskDueDate" 
              [(ngModel)]="newTask.dueDate" 
              name="dueDate"
              required
            >
          </div>
        </div>
        
        <div class="form-group">
          <label for="taskProject">Project *</label>
          <select 
            id="taskProject" 
            [(ngModel)]="newTask.projectId" 
            name="projectId"
            required
          >
            <option value="">Select a project</option>
            <option *ngFor="let project of availableProjects" [value]="project.id">
              {{ project.name }}
            </option>
          </select>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeCreateTaskModal()">Cancel</button>
          <button type="submit" class="btn-primary">Create Task</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Create and Assign Task Modal -->
<div class="modal-overlay" *ngIf="showCreateAndAssignTaskModal" (click)="closeCreateAndAssignTaskModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Create and Assign Task</h2>
      <button class="close-btn" (click)="closeCreateAndAssignTaskModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="modal-body">
      <form class="create-assign-task-form" (ngSubmit)="submitCreateAndAssignTask()">
        <div class="form-group">
          <label for="newTaskTitle">Task Title *</label>
          <input 
            type="text" 
            id="newTaskTitle" 
            [(ngModel)]="newTaskForm.title" 
            name="title"
            placeholder="Enter task title"
            required
          >
        </div>
        
        <div class="form-group">
          <label for="newTaskDescription">Description</label>
          <textarea 
            id="newTaskDescription" 
            [(ngModel)]="newTaskForm.description" 
            name="description"
            placeholder="Enter task description"
            rows="3"
          ></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="newTaskPriority">Priority</label>
            <select 
              id="newTaskPriority" 
              [(ngModel)]="newTaskForm.priority" 
              name="priority"
            >
              <option value="LOW">Low</option>
              <option value="MEDIUM">Medium</option>
              <option value="HIGH">High</option>
              <option value="CRITICAL">Critical</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="newTaskDueDate">Due Date *</label>
            <input 
              type="date" 
              id="newTaskDueDate" 
              [(ngModel)]="newTaskForm.dueDate" 
              name="dueDate"
              required
            >
          </div>
        </div>
        
        <div class="form-group">
          <label for="newTaskProject">Project *</label>
          <select 
            id="newTaskProject" 
            [(ngModel)]="newTaskForm.projectId" 
            name="projectId"
            required
          >
            <option value="">Select a project</option>
            <option *ngFor="let project of availableProjects" [value]="project.id">
              {{ project.name }}
            </option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="newTaskUser">Assign to User *</label>
          <select 
            id="newTaskUser" 
            [(ngModel)]="newTaskForm.userId" 
            name="userId"
            required
          >
            <option value="">Select a user ({{ availableUsers.length || 0 }} available)</option>
            <option *ngFor="let user of availableUsers" [value]="user.id">
              {{ user.name }} ({{ user.email }}) - {{ user.role }}
            </option>
          </select>
                   <!-- Debug info -->
         <small style="color: #666; font-size: 12px;">
           Debug: {{ availableUsers.length || 0 }} users loaded
         </small>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeCreateAndAssignTaskModal()">Cancel</button>
          <button type="submit" class="btn-primary">Create and Assign Task</button>
        </div>
      </form>
    </div>
  </div>
</div>
