<!-- TaskFlow Admin Dashboard - Premium Design -->
<div class="dashboard-container">
  <!-- Left Sidebar Navigation -->
  <nav class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <span class="logo-text" *ngIf="!sidebarCollapsed">TaskFlow</span>
      </div>
    </div>
    
    <div class="sidebar-nav">
      <a class="nav-item" [class.active]="activeTab === 'dashboard'" (click)="setActiveTab('dashboard')">
        <mat-icon>dashboard</mat-icon>
        <span *ngIf="!sidebarCollapsed">Dashboard</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'projects'" (click)="setActiveTab('projects')">
        <mat-icon>folder</mat-icon>
        <span *ngIf="!sidebarCollapsed">Projects</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'tasks'" (click)="setActiveTab('tasks')">
        <mat-icon>task</mat-icon>
        <span *ngIf="!sidebarCollapsed">Tasks</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'reports'" (click)="setActiveTab('reports')">
        <mat-icon>bar_chart</mat-icon>
        <span *ngIf="!sidebarCollapsed">Reports</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'team'" (click)="setActiveTab('team')">
        <mat-icon>group</mat-icon>
        <span *ngIf="!sidebarCollapsed">Team</span>
      </a>
      <a class="nav-item" [class.active]="activeTab === 'settings'" (click)="setActiveTab('settings')">
        <mat-icon>settings</mat-icon>
        <span *ngIf="!sidebarCollapsed">Settings</span>
      </a>
    </div>
    
    <div class="sidebar-footer">
      <button class="collapse-btn" (click)="toggleSidebar()">
        <mat-icon>{{ sidebarCollapsed ? 'chevron_right' : 'chevron_left' }}</mat-icon>
      </button>
    </div>
  </nav>

  <!-- Main Content Area -->
  <main class="main-content" [class.sidebar-collapsed]="sidebarCollapsed">
    <!-- Top Header -->
    <header class="header">
      <div class="search-container">
        <mat-icon class="search-icon">search</mat-icon>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search projects, tasks, or team members..."
          [(ngModel)]="searchQuery"
          (input)="onSearch()"
        >
      </div>
      
      <div class="header-actions">
        <button class="notification-btn" (click)="showNotifications()">
          <mat-icon>notifications</mat-icon>
          <span class="notification-dot" *ngIf="hasNotifications"></span>
        </button>
        
        <div class="user-profile">
          <div class="avatar">
            <img *ngIf="currentUser?.profilePhotoUrl" 
                 [src]="getProfilePhotoUrl(currentUser?.profilePhotoUrl)" 
                 alt="Profile Photo" 
                 class="profile-image"
                 (load)="onImageLoad($event)"
                 (error)="onImageError($event)">
            <mat-icon *ngIf="!currentUser?.profilePhotoUrl">person</mat-icon>
          </div>
          <div class="user-info" *ngIf="currentUser">
            <div class="user-name">{{ currentUser.name }}</div>
            <div class="user-role-tag admin">{{ currentUser.role }}</div>
          </div>
        </div>
      </div>
    </header>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="action-btn add-user-btn" (click)="addUser()">
        <mat-icon>person_add</mat-icon>
        <span>+ Add User</span>
      </button>
      <button class="action-btn new-project-btn" (click)="newProject()">
        <mat-icon>add</mat-icon>
        <span>+ New Project</span>
      </button>
      <button class="action-btn analytics-btn" (click)="viewAnalytics()">
        <mat-icon>analytics</mat-icon>
        <span>View Analytics</span>
      </button>
    </div>

    <!-- Main Content -->
    <div class="dashboard-content">
      <!-- Dashboard Tab -->
      <div *ngIf="activeTab === 'dashboard'" class="content-area">
        <!-- Quick Actions Grid -->
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Quick Actions</h2>
            <p class="section-subtitle">Common tasks and shortcuts</p>
          </div>
          <div class="quick-actions">
            <div class="quick-actions-grid">
              <div *ngFor="let action of quickActions" 
                   class="quick-action-card" 
                   [class]="action.color"
                   (click)="executeQuickAction(action.action)">
                <div class="action-icon" [class]="action.color">
                  <mat-icon>{{ action.icon }}</mat-icon>
                </div>
                <div class="action-label">{{ action.label }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- System Performance -->
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">System Performance</h2>
            <p class="section-subtitle">Real-time system metrics</p>
          </div>
          <div class="system-performance">
            <div class="performance-grid">
              <div class="performance-card">
                <div class="performance-header">
                  <h4>CPU Usage</h4>
                  <span class="performance-value">{{ systemMetrics.cpuUsage }}%</span>
                </div>
                <div class="performance-bar">
                  <div class="performance-fill" [style.width.%]="systemMetrics.cpuUsage"></div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-header">
                  <h4>Memory Usage</h4>
                  <span class="performance-value">{{ systemMetrics.memoryUsage }}%</span>
                </div>
                <div class="performance-bar">
                  <div class="performance-fill" [style.width.%]="systemMetrics.memoryUsage"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Notifications -->
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Recent Notifications</h2>
            <div class="header-actions">
              <button class="refresh-btn" (click)="clearAllNotifications()">
                <mat-icon>clear_all</mat-icon>
                Clear All
              </button>
            </div>
          </div>
          <div class="recent-notifications">
            <div class="notifications-list">
              <div *ngFor="let notification of recentNotifications.slice(0, 5)" 
                   class="notification-item" 
                   [class]="notification.type"
                   [class.unread]="!notification.read"
                   (click)="markNotificationAsRead(notification.id)">
                <div class="notification-icon">
                  <mat-icon *ngIf="notification.type === 'info'">info</mat-icon>
                  <mat-icon *ngIf="notification.type === 'warning'">warning</mat-icon>
                  <mat-icon *ngIf="notification.type === 'error'">error</mat-icon>
                  <mat-icon *ngIf="notification.type === 'success'">check_circle</mat-icon>
                </div>
                <div class="notification-content">
                  <div class="notification-title">{{ notification.title }}</div>
                  <div class="notification-message">{{ notification.message }}</div>
                  <div class="notification-time">{{ notification.timestamp | date:'short' }}</div>
                </div>
                <button class="notification-action" *ngIf="!notification.read">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Team Tab -->
      <div *ngIf="activeTab === 'team'" class="content-area">
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Team Management</h2>
            <div class="header-actions">
              <button class="refresh-btn" (click)="refreshTeamData()">
                <mat-icon>refresh</mat-icon>
                Refresh
              </button>
            </div>
          </div>

          <!-- User Statistics -->
          <div class="team-stats">
            <div class="team-stat">
              <h3>{{ userStatistics.totalUsers || 0 }}</h3>
              <p>Total Users</p>
            </div>
            <div class="team-stat">
              <h3>{{ userStatistics.adminUsers || 0 }}</h3>
              <p>Admins</p>
            </div>
            <div class="team-stat">
              <h3>{{ userStatistics.managerUsers || 0 }}</h3>
              <p>Managers</p>
            </div>
            <div class="team-stat">
              <h3>{{ userStatistics.regularUsers || 0 }}</h3>
              <p>Regular Users</p>
            </div>
          </div>

          <!-- Users List -->
          <div class="user-list">
            <h3>All Users</h3>
            <div class="user-item" *ngFor="let user of allUsers">
              <div class="user-info">
                <div class="user-avatar">
                  <span>{{ user.name.charAt(0) }}</span>
                </div>
                <div class="user-details">
                  <h4>{{ user.name }}</h4>
                  <p>{{ user.email }}</p>
                </div>
              </div>
              <div class="user-actions">
                <span class="role-badge" [class]="user.role.toLowerCase()">{{ user.role }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div *ngIf="activeTab === 'settings'" class="content-area">
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">Settings</h2>
          </div>
          
          <!-- Profile Settings -->
          <div class="setting-section">
            <h3>Profile Settings</h3>
            <div class="profile-info">
              <div class="profile-photo-section">
                <div class="profile-photo">
                  <img *ngIf="currentUser?.profilePhotoUrl" 
                       [src]="getProfilePhotoUrl(currentUser?.profilePhotoUrl)" 
                       alt="Profile Photo" 
                       class="profile-image"
                       (load)="onImageLoad($event)"
                       (error)="onImageError($event)">
                  <div *ngIf="!currentUser?.profilePhotoUrl" class="profile-placeholder">
                    <mat-icon>person</mat-icon>
                  </div>
                  <div *ngIf="uploadingPhoto" class="upload-loading">
                    <mat-spinner diameter="24"></mat-spinner>
                    <span>Uploading...</span>
                  </div>
                </div>
                <div class="photo-actions">
                  <button class="action-btn" (click)="uploadNewPhoto()">
                    <mat-icon>upload</mat-icon>
                    Upload Photo
                  </button>
                  <button *ngIf="currentUser?.profilePhotoUrl" class="action-btn secondary" (click)="removeProfilePhoto()">
                    <mat-icon>delete</mat-icon>
                    Remove Photo
                  </button>
                </div>
              </div>
              <div class="profile-details">
                <div class="info-item">
                  <label>Name:</label>
                  <span>{{ currentUser?.name }}</span>
                  <button class="edit-btn" (click)="editProfile()">
                    <mat-icon>edit</mat-icon>
                  </button>
                </div>
                <div class="info-item">
                  <label>Email:</label>
                  <span>{{ currentUser?.email }}</span>
                </div>
                <div class="info-item">
                  <label>Role:</label>
                  <span>{{ currentUser?.role }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Security Settings -->
          <div class="setting-section">
            <h3>Security</h3>
            <div class="security-actions">
              <button class="action-btn" (click)="changePassword()">
                <mat-icon>lock</mat-icon>
                Change Password
              </button>
              <button class="action-btn" (click)="showTwoFactorAuth()">
                <mat-icon>security</mat-icon>
                Two-Factor Authentication
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modals -->
<!-- Photo Preview Modal -->
<div class="modal-overlay" *ngIf="showPhotoPreviewModal" (click)="closePhotoPreviewModal()">
  <div class="modal-content photo-preview-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Preview Photo</h3>
      <button class="close-btn" (click)="closePhotoPreviewModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-body">
      <div class="photo-preview-container">
        <img [src]="selectedPhotoPreview" alt="Photo Preview" class="preview-image">
        <p class="preview-text">This is how your profile photo will look. Continue with upload?</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closePhotoPreviewModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="confirmPhotoUpload()" [disabled]="uploadingPhoto">
        <mat-spinner diameter="16" *ngIf="uploadingPhoto"></mat-spinner>
        {{ uploadingPhoto ? 'Uploading...' : 'Upload Photo' }}
      </button>
    </div>
  </div>
</div>

<!-- Photo Upload Modal -->
<div class="modal-overlay" *ngIf="showPhotoUploadModal" (click)="closePhotoUploadModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Upload Profile Photo</h3>
      <button class="close-btn" (click)="closePhotoUploadModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-body">
      <div class="text-center mb-4">
        <div class="upload-icon">
          <mat-icon>photo_camera</mat-icon>
        </div>
        <p>Choose a photo to upload as your profile picture</p>
        <p class="text-small">Supported formats: JPG, PNG, GIF (Max 5MB)</p>
      </div>
      
      <!-- File Input -->
      <div class="file-input-container">
        <input type="file" 
               #fileInput
               accept="image/*" 
               class="file-input" 
               (change)="onFileSelected($event)">
        <button class="btn btn-primary" (click)="fileInput.click()">
          <mat-icon>upload</mat-icon>
          Choose File
        </button>
      </div>
      
      <!-- Preview Section -->
      <div *ngIf="selectedPhotoPreview" class="preview-section">
        <h4>Preview:</h4>
        <div class="preview-container">
          <img [src]="selectedPhotoPreview" alt="Photo Preview" class="preview-image">
          <button class="remove-btn" (click)="removeSelectedPhoto()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closePhotoUploadModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="confirmPhotoUpload()" [disabled]="!selectedPhotoFile || uploadingPhoto">
        <mat-spinner diameter="16" *ngIf="uploadingPhoto"></mat-spinner>
        {{ uploadingPhoto ? 'Uploading...' : 'Upload Photo' }}
      </button>
    </div>
  </div>
</div>

<!-- Profile Edit Modal -->
<div class="modal-overlay" *ngIf="showProfileEditModal" (click)="closeProfileEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Edit Profile</h3>
      <button class="close-btn" (click)="closeProfileEditModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="profileForm" class="profile-form">
        <mat-form-field>
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter your name">
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" placeholder="Enter your email" type="email">
        </mat-form-field>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeProfileEditModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="updateProfile()" [disabled]="!profileForm.valid || updatingProfile">
        <mat-spinner diameter="16" *ngIf="updatingProfile"></mat-spinner>
        {{ updatingProfile ? 'Updating...' : 'Update Profile' }}
      </button>
    </div>
  </div>
</div>

<!-- Change Password Modal -->
<div class="modal-overlay" *ngIf="showPasswordModal" (click)="closePasswordModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Change Password</h3>
      <button class="close-btn" (click)="closePasswordModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="passwordForm" class="password-form">
        <mat-form-field>
          <mat-label>Current Password</mat-label>
          <input matInput formControlName="currentPassword" placeholder="Enter current password" type="password">
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>New Password</mat-label>
          <input matInput formControlName="newPassword" placeholder="Enter new password" type="password">
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>Confirm New Password</mat-label>
          <input matInput formControlName="confirmPassword" placeholder="Confirm new password" type="password">
        </mat-form-field>
        
        <div class="error-message" *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('newPassword')?.value && passwordForm.get('confirmPassword')?.value">
          Passwords do not match
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closePasswordModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="submitChangePassword()" [disabled]="!passwordForm.valid || changingPassword">
        <mat-spinner diameter="16" *ngIf="changingPassword"></mat-spinner>
        {{ changingPassword ? 'Changing...' : 'Change Password' }}
      </button>
    </div>
  </div>
</div>

<!-- Add User Modal -->
<div class="modal-overlay" *ngIf="showAddUserModal" (click)="closeAddUserModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add New User</h3>
      <button class="close-btn" (click)="closeAddUserModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="addUserForm" class="add-user-form">
        <mat-form-field>
          <mat-label>Full Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter full name">
          <mat-error *ngIf="addUserForm.get('name')?.hasError('required')">
            Name is required
          </mat-error>
          <mat-error *ngIf="addUserForm.get('name')?.hasError('minlength')">
            Name must be at least 2 characters
          </mat-error>
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" placeholder="Enter email address" type="email">
          <mat-error *ngIf="addUserForm.get('email')?.hasError('required')">
            Email is required
          </mat-error>
          <mat-error *ngIf="addUserForm.get('email')?.hasError('email')">
            Please enter a valid email
          </mat-error>
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>Password</mat-label>
          <input matInput formControlName="password" placeholder="Enter password" type="password">
          <mat-error *ngIf="addUserForm.get('password')?.hasError('required')">
            Password is required
          </mat-error>
          <mat-error *ngIf="addUserForm.get('password')?.hasError('minlength')">
            Password must be at least 6 characters
          </mat-error>
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>Confirm Password</mat-label>
          <input matInput formControlName="confirmPassword" placeholder="Confirm password" type="password">
          <mat-error *ngIf="addUserForm.get('confirmPassword')?.hasError('required')">
            Please confirm your password
          </mat-error>
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>Role</mat-label>
          <mat-select formControlName="role">
            <mat-option value="USER">User</mat-option>
            <mat-option value="MANAGER">Manager</mat-option>
            <mat-option value="ADMIN">Admin</mat-option>
          </mat-select>
          <mat-error *ngIf="addUserForm.get('role')?.hasError('required')">
            Role is required
          </mat-error>
        </mat-form-field>
        
        <div class="error-message" *ngIf="addUserForm.errors?.['passwordMismatch'] && addUserForm.get('password')?.value && addUserForm.get('confirmPassword')?.value">
          Passwords do not match
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddUserModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="submitAddUser()" [disabled]="!addUserForm.valid || addingUser">
        <mat-spinner diameter="16" *ngIf="addingUser"></mat-spinner>
        {{ addingUser ? 'Creating...' : 'Create User' }}
      </button>
    </div>
  </div>
</div>

<!-- New Project Modal -->
<div class="modal-overlay" *ngIf="showNewProjectModal" (click)="closeNewProjectModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Create New Project</h3>
      <button class="close-btn" (click)="closeNewProjectModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="newProjectForm" class="new-project-form">
        <mat-form-field>
          <mat-label>Project Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter project name">
          <mat-error *ngIf="newProjectForm.get('name')?.hasError('required')">
            Project name is required
          </mat-error>
          <mat-error *ngIf="newProjectForm.get('name')?.hasError('minlength')">
            Project name must be at least 2 characters
          </mat-error>
        </mat-form-field>
        
        <mat-form-field>
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description" placeholder="Enter project description" rows="3"></textarea>
          <mat-error *ngIf="newProjectForm.get('description')?.hasError('maxlength')">
            Description must be less than 500 characters
          </mat-error>
        </mat-form-field>
        
        <div class="form-row">
          <mat-form-field>
            <mat-label>Due Date</mat-label>
            <input matInput formControlName="dueDate" type="date">
            <mat-error *ngIf="newProjectForm.get('dueDate')?.hasError('required')">
              Due date is required
            </mat-error>
          </mat-form-field>
          
          <mat-form-field>
            <mat-label>Priority</mat-label>
            <mat-select formControlName="priority">
              <mat-option value="LOW">Low</mat-option>
              <mat-option value="MEDIUM">Medium</mat-option>
              <mat-option value="HIGH">High</mat-option>
            </mat-select>
            <mat-error *ngIf="newProjectForm.get('priority')?.hasError('required')">
              Priority is required
            </mat-error>
          </mat-form-field>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeNewProjectModal()">
        Cancel
      </button>
      <button class="btn btn-primary" (click)="submitNewProject()" [disabled]="!newProjectForm.valid || creatingProject">
        <mat-spinner diameter="16" *ngIf="creatingProject"></mat-spinner>
        {{ creatingProject ? 'Creating...' : 'Create Project' }}
      </button>
    </div>
  </div>
</div>
