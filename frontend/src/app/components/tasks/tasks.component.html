<div class="tasks-container">
  <div class="tasks-header">
    <h1>Tasks</h1>
    <button mat-raised-button color="primary" (click)="createTask()">
      <mat-icon>add</mat-icon>
      Create Task
    </button>
  </div>

  <div class="tasks-filters">
    <mat-form-field appearance="outline">
      <mat-label>Filter by Status</mat-label>
      <mat-select [(value)]="filterStatus">
        <mat-option value="all">All Tasks</mat-option>
        <mat-option value="TODO">To Do</mat-option>
        <mat-option value="IN_PROGRESS">In Progress</mat-option>
        <mat-option value="DONE">Done</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="tasks-content">
    <div *ngIf="loading" class="loading">
      <mat-spinner></mat-spinner>
      <p>Loading tasks...</p>
    </div>

    <div *ngIf="!loading && filteredTasks.length === 0" class="no-tasks">
      <mat-icon>assignment</mat-icon>
      <h3>No tasks found</h3>
      <p *ngIf="filterStatus === 'all'">Create your first task to get started</p>
      <p *ngIf="filterStatus !== 'all'">No tasks with the selected status</p>
      <button *ngIf="filterStatus === 'all'" mat-raised-button color="primary" (click)="createTask()">
        Create Task
      </button>
    </div>

    <div *ngIf="!loading && filteredTasks.length > 0" class="tasks-grid">
      <mat-card *ngFor="let task of filteredTasks" class="task-card">
        <mat-card-header>
          <mat-card-title>{{ task.title }}</mat-card-title>
          <mat-card-subtitle>
            Project: {{ task.project?.name || 'No Project' }} | 
            Due: {{ task.dueDate | date }}
          </mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          <p>{{ task.description || 'No description available' }}</p>
          
          <div class="task-meta">
            <mat-chip [class]="getStatusClass(task.status)" color="primary">
              {{ getStatusLabel(task.status) }}
            </mat-chip>
            
            <div class="task-assignee" *ngIf="task.assignedUser">
              <mat-icon>person</mat-icon>
              <span>{{ task.assignedUser.name }}</span>
            </div>
          </div>
        </mat-card-content>
        
        <mat-card-actions>
          <button mat-button [matMenuTriggerFor]="statusMenu">
            <mat-icon>update</mat-icon>
            Update Status
          </button>
          <mat-menu #statusMenu="matMenu">
            <button mat-menu-item (click)="updateTaskStatus(task, 'TODO')">
              <mat-icon>schedule</mat-icon>
              To Do
            </button>
            <button mat-menu-item (click)="updateTaskStatus(task, 'IN_PROGRESS')">
              <mat-icon>play_arrow</mat-icon>
              In Progress
            </button>
            <button mat-menu-item (click)="updateTaskStatus(task, 'DONE')">
              <mat-icon>check_circle</mat-icon>
              Done
            </button>
          </mat-menu>
          <button mat-button color="warn" (click)="deleteTask(task)">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
